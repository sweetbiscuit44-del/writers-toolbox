<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Writer‚Äôs Tool Box ‚úçÔ∏è</title>
  <style>
    body {
      font-family: 'Segoe UI', system-ui, sans-serif;
      max-width: 700px;
      margin: 0 auto;
      padding: 20px;
      background: #fafafa;
      color: #333;
    }
    h1, h2 {
      text-align: center;
      color: #2c3e50;
    }
    .tool {
      background: white;
      border-radius: 10px;
      padding: 20px;
      margin: 25px 0;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    }
    textarea, input, button {
      width: 100%;
      padding: 10px;
      margin: 8px 0;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-size: 16px;
      box-sizing: border-box;
    }
    textarea {
      min-height: 120px;
      font-family: inherit;
    }
    .result {
      background: #f8f9ff;
      padding: 12px;
      border-radius: 6px;
      margin-top: 10px;
      white-space: pre-wrap;
    }
    footer {
      text-align: center;
      margin-top: 40px;
      color: #777;
      font-style: italic;
    }
    .heart { color: #e74c3c; }
    .paypal-button {
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <h1>Writer‚Äôs Tool Box ‚úçÔ∏è</h1>

  <!-- Tool 1: Focus Writer -->
  <div class="tool">
    <h2>1. Focus Writer</h2>
    <textarea id="writer" placeholder="Write freely‚Äîauto-save works when allowed..."></textarea>
    <div class="result" id="wordCount">Words: 0</div>
  </div>

  <!-- Tool 2: Readability Checker -->
  <div class="tool">
    <h2>2. Readability Score</h2>
    <textarea id="readText" placeholder="Paste your draft to check reading ease"></textarea>
    <button onclick="checkReadability()">Analyze Readability</button>
    <div class="result" id="readResult">Result will appear here.</div>
  </div>

  <!-- Tool 3: Haiku Generator -->
  <div class="tool">
    <h2>3. Haiku Inspiration</h2>
    <button onclick="generateHaiku()">‚ú® Generate a Haiku</button>
    <div class="result" id="haikuResult">Your haiku will appear here.</div>
  </div>

  <!-- Tool 4: Tone Softener -->
  <div class="tool">
    <h2>4. Tone & CAPS Fixer</h2>
    <textarea id="toneText" placeholder="Paste a message to soften tone or fix ALL CAPS"></textarea>
    <button onclick="softenTone()">Soften Tone + Fix CAPS</button>
    <div class="result" id="toneResult">Revised text will appear here.</div>
  </div>

  <!-- Tool 5: Export as .txt -->
  <div class="tool">
    <h2>5. Export as .txt</h2>
    <button onclick="exportText()">üíæ Download Your Writing as .txt</button>
  </div>

  <footer>
    Created with love by Sweet Biscuit44 <span class="heart">‚ù§Ô∏è</span><br>
    One HTML file. Zero tracking. All heart.<br>
    Your support keeps these tools free üíñ
    <div class="paypal-button">
      <a href="https://www.paypal.com/paypalme/sweetbiscuit44" target="_blank">
        <img src="https://www.paypalobjects.com/webstatic/en_US/i/buttons/ppcredit-logo-small.png" alt="Support via PayPal" style="height:30px;">
      </a>
    </div>
  </footer>

  <script>
    // ===== SAFE LOCALSTORAGE CHECK =====
    let canUseStorage = false;
    try {
      const test = '__storage_test__';
      localStorage.setItem(test, test);
      localStorage.removeItem(test);
      canUseStorage = true;
    } catch(e) {
      console.warn("localStorage unavailable (e.g., file:// mode). Auto-save disabled.");
    }

    // ===== FOCUS WRITER =====
    const writer = document.getElementById('writer');
    const wordCountEl = document.getElementById('wordCount');

    if (canUseStorage && localStorage.getItem('writerText')) {
      writer.value = localStorage.getItem('writerText');
    }

    writer.addEventListener('input', () => {
      if (canUseStorage) {
        localStorage.setItem('writerText', writer.value);
      }
      const words = writer.value.trim() ? writer.value.trim().split(/\s+/).length : 0;
      wordCountEl.textContent = canUseStorage 
        ? `Words: ${words} (auto-saved)` 
        : `Words: ${words} (auto-save disabled in file:// mode)`;
    });

    // ===== READABILITY CHECKER =====
    function checkReadability() {
      const text = document.getElementById('readText').value;
      if (!text.trim()) return document.getElementById('readResult').textContent = "Please enter text.";
      const words = text.trim().split(/\s+/).length;
      const sentences = text.split(/[.!?]+/).filter(s => s.trim()).length || 1;
      const score = 206.835 - 1.015 * (words / sentences) - 84.6;
      const grade = score > 90 ? "5th grade (very easy)" :
                    score > 80 ? "6th grade" :
                    score > 70 ? "7th grade" :
                    score > 60 ? "8th‚Äì9th grade" :
                    score > 50 ? "10th‚Äì12th grade" :
                    score > 30 ? "College" : "College Graduate";
      document.getElementById('readResult').textContent = 
        `Readability Score: ${Math.round(score)}\nApprox. Grade Level: ${grade}`;
    }

    // ===== HAIKU GENERATOR =====
    const lines5 = ["Morning sun rises", "Silent moon above", "Rain taps the window", "Leaves fall without sound", "Coffee steam curls up"];
    const lines7 = ["A bird sings in the old oak tree", "Thoughts drift like clouds across the sky", "My cat watches birds with sharp eyes", "Words flow like rivers in my mind", "Night wraps the world in softest blue"];
    function generateHaiku() {
      const h1 = lines5[Math.floor(Math.random() * lines5.length)];
      const h2 = lines7[Math.floor(Math.random() * lines7.length)];
      const h3 = lines5[Math.floor(Math.random() * lines5.length)];
      document.getElementById('haikuResult').textContent = `${h1}\n${h2}\n${h3}`;
    }

    // ===== SMART TONE + CAPS FIXER =====
    function fixAccidentalCaps(text) {
      const alphaChars = text.replace(/[^a-zA-Z]/g, '');
      if (alphaChars.length < 4) return text;
      const upperRatio = (alphaChars.match(/[A-Z]/g) || []).length / alphaChars.length;
      if (upperRatio < 0.8) return text;

      return text
        .split(/([.!?]+)/)
        .map((part, i) => {
          if (i % 2 === 1) return part;
          return part
            .toLowerCase()
            .replace(/(^|[.!?]\s+)([a-z])/g, (match, p1, p2) => p1 + p2.toUpperCase());
        })
        .join('');
    }

    function softenToneIntelligently(text) {
      let result = text;

      result = result.replace(/\b(you should)\s+([a-z])/gi, "you might consider $2");
      result = result.replace(/\b(can't|cannot)\b/gi, "might not be able to");
      result = result.replace(/\b(this is wrong)\b/gi, "this might need a second look");
      result = result.replace(/\b(obviously|clearly|everyone knows)\b/gi, "it seems");
      result = result.replace(/\b(just do it|do this now|fix this)\b/gi, "could you please try?");
      result = result.replace(/\b(no way|never going to work|terrible idea)\b/gi, "that might be difficult");
      result = result.replace(/\b(you failed|you messed up|you forgot)\b/gi, "there might have been a hiccup with");

      return result;
    }

    function softenTone() {
      let text = document.getElementById('toneText').value;
      if (!text.trim()) return document.getElementById('toneResult').textContent = "Enter a message.";

      text = fixAccidentalCaps(text);
      let soft = softenToneIntelligently(text);

      if (/[a-zA-Z]$/.test(soft.trim())) {
        soft = soft.trim() + '.';
      }

      document.getElementById('toneResult').textContent = soft;
    }

    // ===== EXPORT AS .TXT =====
    function exportText() {
      const content = writer.value || "Your writing from the Focus Writer.";
      const blob = new Blob([content], { type: 'text/plain' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'my-writing.txt';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }
  </script>
</body>
</html>